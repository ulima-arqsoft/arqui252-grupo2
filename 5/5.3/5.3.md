> [5. T√°cticas](../5.md) ‚Ä∫ [5.3. M√≥dulo 3 / Integrante 3](5.3.md)

# 5.3. M√≥dulo 3 /  Autenticaci√≥n y Seguridad



## T√°ctica : Disponibilidad ‚Äî ESC-09

### Escenario
| **Cod Escenario** | **Atributo de Calidad** | **Est√≠mulo**                                  | **Fuente del Est√≠mulo** | **Artefacto**                  | **Entorno** | **Respuesta**                                                                                 | **Medida de Respuesta**      |
|-------------------|--------------------------|-----------------------------------------------|-------------------------|--------------------------------|------------|------------------------------------------------------------------------------------------------|------------------------------|
| ESC-09            | Disponibilidad           | Pico de 100 logins por minuto con verificaci√≥n 2FA | Usuarios leg√≠timos      | AuthService + verificaci√≥n 2FA | Hora pico  | Escala horizontal con rate-limit por IP/usuario; procesa logins sin ca√≠da del servicio de 2FA | P95 < 2 s; error rate < 1%   |

### T√°ctica Elegida
**Autoescalado + Rate limiting en gateway con contadores en Redis.**

### Documentaci√≥n de la Decisi√≥n (ADR)
**T√≠tulo:** Autoescalado del AuthService con rate-limit por identidad  
**Contexto:** En picos, login y 2FA se degradan si no se controla volumen por identidad/IP.  
**Alternativas:**
- Solo escalado.
- Solo rate-limit.
- Escalado + rate-limit coordinados.
**Decisi√≥n:** Escalado horizontal (r√©plicas) + rate-limit multi-dimensi√≥n (IP/usuario/dispositivo) en gateway; contadores/TTL en Redis.  
**Sustento:** Mantiene disponibilidad y latencia estable sin sobrecargar BD; coherente con ‚Äúvalidar todo en backend/middleware‚Äù y Redis para contadores.

---

## T√°ctica : Disponibilidad ‚Äî ESC-10

### Escenario
| **Cod Escenario** | **Atributo de Calidad** | **Est√≠mulo**                                                          | **Fuente del Est√≠mulo** | **Artefacto**                       | **Entorno** | **Respuesta**                                                                 | **Medida de Respuesta**                 |
|-------------------|--------------------------|------------------------------------------------------------------------|-------------------------|-------------------------------------|------------|------------------------------------------------------------------------------|-----------------------------------------|
| ESC-10            | Disponibilidad           | Ca√≠da del proveedor externo de correo/OTP en recuperaci√≥n de cuenta   | Servicio externo        | Flujo de recuperaci√≥n de contrase√±a | Producci√≥n | Reintentos con backoff y fallback de proveedor; circuit breaker en gateway   | √âxito ‚â• 99% en 15 min; notificaci√≥n < 2 min |

### T√°ctica Elegida
**Reintentos con backoff + Fallback de proveedor + Circuit Breaker.**

### Documentaci√≥n de la Decisi√≥n (ADR)
**T√≠tulo:** Resiliencia ante fallos de correo/OTP  
**Contexto:** Dependencias externas interrumpen el flujo si no hay tolerancia a fallos.  
**Alternativas:**
- Reintentos simples.
- Circuit breaker sin fallback.
- Circuit breaker + backoff + proveedor alterno.
**Decisi√≥n:** Abrir circuito ante error sostenido, aplicar backoff exponencial y conmutar a canal alterno (p. ej., SMS/backup-email/c√≥digos de respaldo).  
**Sustento:** Garantiza continuidad del proceso con metas de √©xito del escenario.

---

## T√°ctica : Seguridad ‚Äî ESC-07

### Escenario
| **Cod Escenario** | **Atributo de Calidad** | **Est√≠mulo**                                                                       | **Fuente del Est√≠mulo** | **Artefacto**        | **Entorno** | **Respuesta**                                                                                           |
|-------------------|--------------------------|-------------------------------------------------------------------------------------|-------------------------|----------------------|------------|----------------------------------------------------------------------------------------------------------|
| ESC-07            | Confidencialidad         | Usuario sin permisos intenta leer datos privados v√≠a acceso directo a endpoints     | Usuario no autorizado   | API de Auth/Usuarios | Producci√≥n | Control estricto por rol/propiedad; 100% de endpoints verifican permisos antes de retornar datos        |

### T√°ctica Elegida
**RBAC estricto en middleware (gateway/backend) con verificaci√≥n en el 100% de endpoints.**

### Documentaci√≥n de la Decisi√≥n (ADR)
**T√≠tulo:** Enforzamiento RBAC en gateway y controladores  
**Contexto:** Debe impedirse lectura de recursos sin permiso/propiedad.  
**Alternativas:**
- Validar en frontend.
- Validar parcialmente.
- Validar 100% en middleware + controladores.
**Decisi√≥n:** Middleware central valida JWT/estado/rol; controladores revalidan propiedad del recurso.  
**Sustento:** Alineado con la decisi√≥n de ‚Äúvalidar todo en backend‚Äù; utiliza Redis (`perm:{userId}`) como cach√© con fallback a BD.

---

## T√°ctica : Seguridad ‚Äî ESC-08

### Escenario
| **Cod Escenario** | **Atributo de Calidad** | **Est√≠mulo**                                                                      | **Fuente del Est√≠mulo** | **Artefacto** | **Entorno** | **Respuesta**                                                                                                           |
|-------------------|--------------------------|------------------------------------------------------------------------------------|-------------------------|---------------|------------|--------------------------------------------------------------------------------------------------------------------------|
| ESC-08            | Integridad               | Token modificado/firmas inv√°lidas o acci√≥n cr√≠tica desde sesi√≥n secuestrada        | Atacante                | API Auth      | Producci√≥n | Rechazo inmediato; re-autenticaci√≥n/2FA; invalidaci√≥n de tokens previos; detecci√≥n de cambio IP < 3 s y logout global < 6 s |

### T√°ctica Elegida
**Validaci√≥n de firma + Detecci√≥n de anomal√≠as + Revocaci√≥n global en Redis.**

### Documentaci√≥n de la Decisi√≥n (ADR)
**T√≠tulo:** Protecci√≥n de sesi√≥n y revocaci√≥n acelerada  
**Contexto:** Riesgo de uso indebido de sesi√≥n/token manipulado.  
**Alternativas:**
- Solo verificaci√≥n de firma.
- Firma + heur√≠stica de IP/dispositivo.
- Firma + heur√≠stica + revocaci√≥n/rotaci√≥n inmediata.
**Decisi√≥n:** Verificar firmas; si anomal√≠a (IP/UA), forzar re-auth o 2FA; revocar `jti` en `sessblk:{jti}` y cerrar sesiones en segundos.  
**Sustento:** Cumple los tiempos del escenario; coordina seguridad con Redis para listas de revocaci√≥n.

---

## T√°ctica : Seguridad ‚Äî ESC-20

### Escenario
| **Cod Escenario** | **Atributo de Calidad** | **Est√≠mulo**                                                      | **Fuente del Est√≠mulo** | **Artefacto**     | **Entorno** | **Respuesta**                                                                                 |
|-------------------|--------------------------|--------------------------------------------------------------------|-------------------------|-------------------|------------|----------------------------------------------------------------------------------------------|
| ESC-20            | Confidencialidad         | Intento de login con credenciales comprometidas/filtradas         | Atacante                | Endpoint de login | Producci√≥n | Rechazar sin revelar si el correo existe; registrar intento; respuesta HTTP 401 en < 300 ms  |

### T√°ctica Elegida
**Respuestas uniformes anti-enumeraci√≥n + Monitoreo de intentos + Integraci√≥n con rate-limit/lockout.**

### Documentaci√≥n de la Decisi√≥n (ADR)
**T√≠tulo:** Mitigaci√≥n de credential stuffing sin enumeraci√≥n de usuarios  
**Contexto:** Evitar filtraci√≥n de existencia de cuentas y abuso del endpoint de login.  
**Alternativas:**
- Mensajes diferenciados.
- √önico mensaje.
- √önico mensaje + registro + rate-limit/lockout coordinados.
**Decisi√≥n:** Respuestas uniformes 401; registrar intento y alimentar rate-limit/lockout (Redis) y alertas de seguridad.  
**Sustento:** Reduce enumeraci√≥n, acelera respuesta (< 300 ms) y coordina con controles de disponibilidad del login.

---

## T√°ctica : Mantenibilidad ‚Äî ESC-06

### Escenario
| **Cod Escenario** | **Atributo de Calidad** | **Est√≠mulo**                                | **Fuente del Est√≠mulo** | **Artefacto**               | **Entorno**           | **Respuesta**                                                     |
|-------------------|--------------------------|----------------------------------------------|-------------------------|-----------------------------|-----------------------|------------------------------------------------------------------|
| ESC-06            | Mantenibilidad           | Cambios en l√≥gica de validaci√≥n de usuarios  | Equipo de desarrollo    | Capa de Auth (validaciones) | Desarrollo/Producci√≥n | Cambios sin afectar otras funciones en < 4 h con pruebas automatizadas |

### T√°ctica Elegida
**Encapsulamiento (Wrapper/Adapter) de librer√≠as de Auth y reglas parametrizables.**

### Documentaci√≥n de la Decisi√≥n (ADR)
**T√≠tulo:** Interfaz estable para JWT/Hash + reglas en configuraci√≥n  
**Contexto:** Actualizaciones por CVE y cambios de reglas no deben romper controladores/servicios.  
**Alternativas:**
- Uso directo de librer√≠as.
- Wrapper con interfaz estable.
- Wrapper + reglas externas (JSON/BD) con validaci√≥n de esquema.
**Decisi√≥n:** `AuthTokenProvider` y `PasswordHasher` tras interfaz; reglas (complejidad, expiraciones, intentos) en configuraci√≥n versionada con hot-reload.  
**Sustento:** Localiza cambios, baja riesgo de regresi√≥n y acelera parches; coherente con ‚Äúvalidar todo en backend/middleware‚Äù.

---

## Resumen de T√°cticas por Atributo de Calidad

| **Atributo de Calidad**     | **Escenario** | **T√°ctica Aplicada**                                              |
|-----------------------------|---------------|--------------------------------------------------------------------|
| Disponibilidad              | ESC-09        | Autoescalado + Rate limiting en gateway                            |
| Disponibilidad              | ESC-10        | Circuit Breaker + Backoff + Fallback de proveedor                  |
| Seguridad (Confidencialidad)| ESC-07        | RBAC estricto en middleware                                        |
| Seguridad (Integridad)      | ESC-08        | Validaci√≥n de firma + Detecci√≥n de anomal√≠as + Revocaci√≥n global   |
| Seguridad (Confidencialidad)| ESC-20        | Respuesta uniforme anti-enumeraci√≥n + monitoreo + lockout          |
| Mantenibilidad              | ESC-06        | Wrapper/Adapter de Auth + reglas parametrizables                   |

[‚¨ÖÔ∏è Anterior](../5.2/5.2.md) | [üè† Home](../../README.md) | [Siguiente ‚û°Ô∏è](../5.4/5.4.md)