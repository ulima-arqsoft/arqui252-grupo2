> [5. Tácticas](../5.md) › [5.3. Módulo 3 / Integrante 3](5.3.md)

# 5.3. Módulo 3 /  Autenticación y Seguridad



## Táctica : Disponibilidad — ESC-09

### Escenario
| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                                  | **Fuente del Estímulo** | **Artefacto**                  | **Entorno** | **Respuesta**                                                                                 | **Medida de Respuesta**      |
|-------------------|--------------------------|-----------------------------------------------|-------------------------|--------------------------------|------------|------------------------------------------------------------------------------------------------|------------------------------|
| ESC-09            | Disponibilidad           | Pico de 100 logins por minuto con verificación 2FA | Usuarios legítimos      | AuthService + verificación 2FA | Hora pico  | Escala horizontal con rate-limit por IP/usuario; procesa logins sin caída del servicio de 2FA | P95 < 2 s; error rate < 1%   |

### Táctica Elegida
**Autoescalado + Rate limiting en gateway con contadores en Redis.**

### Documentación de la Decisión (ADR)
**Título:** Autoescalado del AuthService con rate-limit por identidad  
**Contexto:** En picos, login y 2FA se degradan si no se controla volumen por identidad/IP.  
**Alternativas:**
- Solo escalado.
- Solo rate-limit.
- Escalado + rate-limit coordinados.
**Decisión:** Escalado horizontal (réplicas) + rate-limit multi-dimensión (IP/usuario/dispositivo) en gateway; contadores/TTL en Redis.  
**Sustento:** Mantiene disponibilidad y latencia estable sin sobrecargar BD; coherente con “validar todo en backend/middleware” y Redis para contadores.

---

## Táctica : Disponibilidad — ESC-10

### Escenario
| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                                                          | **Fuente del Estímulo** | **Artefacto**                       | **Entorno** | **Respuesta**                                                                 | **Medida de Respuesta**                 |
|-------------------|--------------------------|------------------------------------------------------------------------|-------------------------|-------------------------------------|------------|------------------------------------------------------------------------------|-----------------------------------------|
| ESC-10            | Disponibilidad           | Caída del proveedor externo de correo/OTP en recuperación de cuenta   | Servicio externo        | Flujo de recuperación de contraseña | Producción | Reintentos con backoff y fallback de proveedor; circuit breaker en gateway   | Éxito ≥ 99% en 15 min; notificación < 2 min |

### Táctica Elegida
**Reintentos con backoff + Fallback de proveedor + Circuit Breaker.**

### Documentación de la Decisión (ADR)
**Título:** Resiliencia ante fallos de correo/OTP  
**Contexto:** Dependencias externas interrumpen el flujo si no hay tolerancia a fallos.  
**Alternativas:**
- Reintentos simples.
- Circuit breaker sin fallback.
- Circuit breaker + backoff + proveedor alterno.
**Decisión:** Abrir circuito ante error sostenido, aplicar backoff exponencial y conmutar a canal alterno (p. ej., SMS/backup-email/códigos de respaldo).  
**Sustento:** Garantiza continuidad del proceso con metas de éxito del escenario.

---

## Táctica : Seguridad — ESC-07

### Escenario
| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                                                                       | **Fuente del Estímulo** | **Artefacto**        | **Entorno** | **Respuesta**                                                                                           |
|-------------------|--------------------------|-------------------------------------------------------------------------------------|-------------------------|----------------------|------------|----------------------------------------------------------------------------------------------------------|
| ESC-07            | Confidencialidad         | Usuario sin permisos intenta leer datos privados vía acceso directo a endpoints     | Usuario no autorizado   | API de Auth/Usuarios | Producción | Control estricto por rol/propiedad; 100% de endpoints verifican permisos antes de retornar datos        |

### Táctica Elegida
**RBAC estricto en middleware (gateway/backend) con verificación en el 100% de endpoints.**

### Documentación de la Decisión (ADR)
**Título:** Enforzamiento RBAC en gateway y controladores  
**Contexto:** Debe impedirse lectura de recursos sin permiso/propiedad.  
**Alternativas:**
- Validar en frontend.
- Validar parcialmente.
- Validar 100% en middleware + controladores.
**Decisión:** Middleware central valida JWT/estado/rol; controladores revalidan propiedad del recurso.  
**Sustento:** Alineado con la decisión de “validar todo en backend”; utiliza Redis (`perm:{userId}`) como caché con fallback a BD.

---

## Táctica : Seguridad — ESC-08

### Escenario
| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                                                                      | **Fuente del Estímulo** | **Artefacto** | **Entorno** | **Respuesta**                                                                                                           |
|-------------------|--------------------------|------------------------------------------------------------------------------------|-------------------------|---------------|------------|--------------------------------------------------------------------------------------------------------------------------|
| ESC-08            | Integridad               | Token modificado/firmas inválidas o acción crítica desde sesión secuestrada        | Atacante                | API Auth      | Producción | Rechazo inmediato; re-autenticación/2FA; invalidación de tokens previos; detección de cambio IP < 3 s y logout global < 6 s |

### Táctica Elegida
**Validación de firma + Detección de anomalías + Revocación global en Redis.**

### Documentación de la Decisión (ADR)
**Título:** Protección de sesión y revocación acelerada  
**Contexto:** Riesgo de uso indebido de sesión/token manipulado.  
**Alternativas:**
- Solo verificación de firma.
- Firma + heurística de IP/dispositivo.
- Firma + heurística + revocación/rotación inmediata.
**Decisión:** Verificar firmas; si anomalía (IP/UA), forzar re-auth o 2FA; revocar `jti` en `sessblk:{jti}` y cerrar sesiones en segundos.  
**Sustento:** Cumple los tiempos del escenario; coordina seguridad con Redis para listas de revocación.

---

## Táctica : Seguridad — ESC-20

### Escenario
| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                                                      | **Fuente del Estímulo** | **Artefacto**     | **Entorno** | **Respuesta**                                                                                 |
|-------------------|--------------------------|--------------------------------------------------------------------|-------------------------|-------------------|------------|----------------------------------------------------------------------------------------------|
| ESC-20            | Confidencialidad         | Intento de login con credenciales comprometidas/filtradas         | Atacante                | Endpoint de login | Producción | Rechazar sin revelar si el correo existe; registrar intento; respuesta HTTP 401 en < 300 ms  |

### Táctica Elegida
**Respuestas uniformes anti-enumeración + Monitoreo de intentos + Integración con rate-limit/lockout.**

### Documentación de la Decisión (ADR)
**Título:** Mitigación de credential stuffing sin enumeración de usuarios  
**Contexto:** Evitar filtración de existencia de cuentas y abuso del endpoint de login.  
**Alternativas:**
- Mensajes diferenciados.
- Único mensaje.
- Único mensaje + registro + rate-limit/lockout coordinados.
**Decisión:** Respuestas uniformes 401; registrar intento y alimentar rate-limit/lockout (Redis) y alertas de seguridad.  
**Sustento:** Reduce enumeración, acelera respuesta (< 300 ms) y coordina con controles de disponibilidad del login.

---

## Táctica : Mantenibilidad — ESC-06

### Escenario
| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                                | **Fuente del Estímulo** | **Artefacto**               | **Entorno**           | **Respuesta**                                                     |
|-------------------|--------------------------|----------------------------------------------|-------------------------|-----------------------------|-----------------------|------------------------------------------------------------------|
| ESC-06            | Mantenibilidad           | Cambios en lógica de validación de usuarios  | Equipo de desarrollo    | Capa de Auth (validaciones) | Desarrollo/Producción | Cambios sin afectar otras funciones en < 4 h con pruebas automatizadas |

### Táctica Elegida
**Encapsulamiento (Wrapper/Adapter) de librerías de Auth y reglas parametrizables.**

### Documentación de la Decisión (ADR)
**Título:** Interfaz estable para JWT/Hash + reglas en configuración  
**Contexto:** Actualizaciones por CVE y cambios de reglas no deben romper controladores/servicios.  
**Alternativas:**
- Uso directo de librerías.
- Wrapper con interfaz estable.
- Wrapper + reglas externas (JSON/BD) con validación de esquema.
**Decisión:** `AuthTokenProvider` y `PasswordHasher` tras interfaz; reglas (complejidad, expiraciones, intentos) en configuración versionada con hot-reload.  
**Sustento:** Localiza cambios, baja riesgo de regresión y acelera parches; coherente con “validar todo en backend/middleware”.

---

## Resumen de Tácticas por Atributo de Calidad

| **Atributo de Calidad**     | **Escenario** | **Táctica Aplicada**                                              |
|-----------------------------|---------------|--------------------------------------------------------------------|
| Disponibilidad              | ESC-09        | Autoescalado + Rate limiting en gateway                            |
| Disponibilidad              | ESC-10        | Circuit Breaker + Backoff + Fallback de proveedor                  |
| Seguridad (Confidencialidad)| ESC-07        | RBAC estricto en middleware                                        |
| Seguridad (Integridad)      | ESC-08        | Validación de firma + Detección de anomalías + Revocación global   |
| Seguridad (Confidencialidad)| ESC-20        | Respuesta uniforme anti-enumeración + monitoreo + lockout          |
| Mantenibilidad              | ESC-06        | Wrapper/Adapter de Auth + reglas parametrizables                   |

[⬅️ Anterior](../5.2/5.2.md) | [🏠 Home](../../README.md) | [Siguiente ➡️](../5.4/5.4.md)