> [4. Decisiones Iniciales de Arquitectura](../4.md) ‚Ä∫ [4.3. M√≥dulo 3 / Integrante 3](4.3.md)



# M√≥dulo 03 ‚Äì Autenticaci√≥n y Seguridad

  

#### Asignaci√≥n de Responsabilidades

  

**T√≠tulo:**

Validaci√≥n de autenticaci√≥n y autorizaci√≥n en backend y middleware

  

**Contexto:**

El m√≥dulo gestiona operaciones sensibles: registro y verificaci√≥n de correo, inicio de sesi√≥n local y social, asignaci√≥n de roles, recuperaci√≥n y rotaci√≥n de credenciales, 2FA TOTP, bloqueo por intentos fallidos, notificaciones de seguridad, pol√≠tica de contrase√±as y eliminaci√≥n o desactivaci√≥n de cuentas. Se debe definir en qu√© capa se controla cada verificaci√≥n para equilibrar seguridad, UX y mantenibilidad.

  

**Alternativas:**

1. Validar todo en el frontend.

2. Validar todo en el backend (incluido gateway/middleware).

3. Validaci√≥n doble: frontend para UX y backend/middleware para seguridad.

  

**Criterios de elecci√≥n:**

- Defensa en profundidad del lado servidor.

- Escalabilidad al a√±adir nuevos roles/permisos.

- Mantenibilidad y trazabilidad.

- Claridad de UX sin exponer l√≥gica sensible en el cliente.

  

**Decisi√≥n:**

Validar **todo en el backend**, incluyendo **gateway/middleware** para verificaci√≥n de sesi√≥n/JWT, estado de cuenta y **RBAC** por rol/permisos en cada request.

  

**Sustento:**

Esta estrategia centraliza la l√≥gica de seguridad en el servidor, evitando que el cliente pueda alterar validaciones.
Permite aplicar pol√≠ticas coherentes y auditables, mejorar el control de accesos y facilitar la trazabilidad de eventos de seguridad.
Adem√°s, reduce el riesgo de omisiones o bypasses desde el frontend y simplifica el mantenimiento de reglas de autorizaci√≥n.

  

---

  

#### Modelo de Coordinaci√≥n

  

**T√≠tulo:**

Estrategia de orquestaci√≥n para login, 2FA, bloqueo y login social

  

**Contexto:**

Los flujos de autenticaci√≥n requieren respuesta inmediata y consistencia: login con correo/contrase√±a y con proveedores externos, desaf√≠o 2FA TOTP con c√≥digos de respaldo, lockout escalonado por intentos fallidos y emisi√≥n/rotaci√≥n de tokens de sesi√≥n.

  

**Alternativas:**

1. Coordinaci√≥n s√≠ncrona v√≠a REST, con cach√© para estados ef√≠meros.

2. Event-driven para todos los pasos.

3. Delegar identidad a un IdP externo (OIDC completo) y usar el backend solo como *resource server*.

  

**Criterios de elecci√≥n:**

- Latencia percibida y simplicidad operacional.

- Consistencia fuerte en pasos cr√≠ticos.

- Facilidad de integrar login social.

- Observabilidad y manejo de errores.

  

**Decisi√≥n:**

Coordinaci√≥n **s√≠ncrona REST** para pasos interactivos (login, 2FA, lockout, registro y reset). Se usa **cach√©** para contadores de intentos y *one-time tokens*. El login social se integra con **OIDC/OAuth2** y *linking* de identidad social.

  

**Sustento:**

Minimiza latencia y complejidad para flujos en tiempo real; OIDC estandariza la integraci√≥n con nuevos proveedores. Los eventos no cr√≠ticos (telemetr√≠a) pueden emitirse as√≠ncronamente.

  

---

  

#### Modelo de Datos

  

**T√≠tulo:**

Esquema relacional + cach√© para identidad, permisos y estados ef√≠meros

  

**Contexto:**

Se requiere integridad en identidades y velocidad en operaciones de sesi√≥n/lockout.

  

**Alternativas:**

1. Solo base de datos relacional.

2. Relacional + cach√© (Redis) para sesiones/contadores.

3. NoSQL para todo.

  

**Criterios de elecci√≥n:**

- Integridad referencial y auditor√≠a m√≠nima.

- Rendimiento en validaciones de login/2FA.

- Simplicidad de consultas RBAC.

  

**Decisi√≥n:**

**Relacional + cach√© (Redis) para sesiones y contadores.**

  

**Sustento:**

Se elige una base de datos relacional para mantener la consistencia y seguridad en los datos cr√≠ticos, como usuarios, credenciales y roles, donde es importante garantizar transacciones seguras (ACID).

Al mismo tiempo, se incorpora una cach√© con Redis para manejar sesiones y contadores (como bloqueos por intentos fallidos o control de tokens), ya que estas operaciones requieren baja latencia y alta velocidad de acceso.


  

---

  

#### Mapeo entre elementos de arquitectura

  

**T√≠tulo:**

Rutas de autenticaci√≥n, middleware de seguridad y guards de UI

  

**Contexto:**

Los flujos de autenticaci√≥n y acciones de seguridad deben separarse y protegerse en varias capas.

  

**Alternativas:**

1. Rutas dedicadas y middleware por cada preocupaci√≥n (auth, 2FA, roles).

2. Rutas compartidas con validaciones dentro de controladores.

  

**Criterios de elecci√≥n:**

- Seguridad y trazabilidad por capa.

- Legibilidad y mantenibilidad.

- Compatibilidad con auditor√≠a y pruebas.

  

**Decisi√≥n:**

Rutas separadas y **middleware** espec√≠fico, con *guards* en frontend para UX (sin l√≥gica de seguridad).

  

**Sustento:**

A√≠sla responsabilidades, facilita pruebas y auditor√≠a.

  

  

---

  

#### Elecci√≥n de Tecnolog√≠a

  

**T√≠tulo:**

Argon2id para hash de contrase√±as; JWT + Refresh con cookies httpOnly; Redis para lockout y revocaci√≥n

  

**Contexto:**

Se requiere proteger credenciales, administrar sesiones de forma segura y soportar logout global tras reset de contrase√±a.

  

**Alternativas:**

-  **Hash:** bcrypt vs Argon2id.

-  **Sesi√≥n:** JWT access + refresh rotativos vs sesi√≥n de servidor.

-  **Almacenamiento de tokens/estado:** cookies httpOnly/SameSite vs `localStorage`.

-  **Rate limiting/lockout:** in-memory vs Redis.

  

**Criterios de elecci√≥n:**

- Resistencia a ataques de fuerza bruta y *offline*.

- Escalabilidad horizontal y experiencia multi-dispositivo.

- Mitigaci√≥n de XSS/CSRF.

- Revocaci√≥n inmediata tras eventos cr√≠ticos.

  

**Decisi√≥n:**

-  **Argon2id** con par√°metros calibrados y *pepper* en servidor.

-  **JWT** de acceso corto + **refresh** rotativo en **cookie httpOnly, Secure, SameSite**; access token en memoria y como Bearer.

-  **Redis** para lockout, *rate limiting* y lista de revocaci√≥n de *jti*.

-  **2FA TOTP** con ventana de tolerancia y **c√≥digos de respaldo** hasheados.

  

**Sustento:**

Centraliza seguridad en el backend, endurece credenciales, reduce superficie ante XSS/CSRF y permite revocaci√≥n inmediata y control fino de intentos fallidos.

---



[‚¨ÖÔ∏è Anterior](../4.2/4.2.md) | [üè† Home](../../README.md) | [Siguiente ‚û°Ô∏è](../4.4/4.4.md)